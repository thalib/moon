# ============================================================================
# Moon - Dynamic Headless Engine Configuration
# ============================================================================
#
# Moon configuration file (spec-compliant).
# Only essential options enabled by default; advanced options are commented out.
# Follow SPEC.md for architecture and operational details.
# Quick Start:
# 1. Copy to /etc/moon.conf
# 2. Change jwt.secret and auth.bootstrap_admin.password
# 3. Uncomment/configure optional features as needed
# 4. Start Moon: moon daemon --config /etc/moon.conf
# ============================================================================

# ============================================================================
# Server Configuration (REQUIRED)
# ============================================================================
# Server Configuration (REQUIRED)
# Host, port, and API prefix for HTTP server.
# - host: "0.0.0.0" (all interfaces), "127.0.0.1" (localhost only)
# - port: 6006 (default, valid range: 1-65535)
# - prefix: "" (no prefix), "/api/v1" (all endpoints under /api/v1)
server:
  host: "0.0.0.0"
  port: 6006
  prefix: ""

# ============================================================================
# Database Configuration (REQUIRED)
# SQLite is default. For Postgres/MySQL, set connection, database, user, password, host.
# Query timeout: max seconds per query. Slow query threshold: log warning if exceeded.
# ============================================================================
database:
  connection: "sqlite"           # Supported: sqlite, postgres, mysql
  database: "/opt/moon/sqlite.db" # Path (SQLite) or name (Postgres/MySQL)
  # user: ""                     # For Postgres/MySQL only
  # password: ""                 # For Postgres/MySQL only
  # host: "0.0.0.0"              # For Postgres/MySQL only
  # query_timeout: 30            # Max seconds per query
  # slow_query_threshold: 500    # Log warning if query exceeds ms

# ============================================================================
# Logging Configuration (REQUIRED)
# ============================================================================
# Logs to {path}/main.log in daemon mode, stdout/stderr in console mode.
logging:
  path: "/var/log/moon"
  # redact_sensitive: true
  # additional_sensitive_fields:
  #   - "ssn"
  #   - "credit_card"

# ============================================================================
# JWT Authentication Configuration (REQUIRED)
# ============================================================================
jwt:
  # JWT secret key for token signing (REQUIRED)
  # This MUST be set to a secure random string in production
  # Generate a secure secret with: openssl rand -base64 32
  # 
  # SECURITY REQUIREMENTS:
  # - Minimum 32 characters recommended
  # - Use cryptographically random value
  # - Never commit to version control
  # - Rotate periodically (invalidates all existing tokens)
  #
  # Example: "dGhpcyBpcyBhIHNlY3VyZSBzZWNyZXQga2V5"
  secret: "your-secret-key-change-in-production"
  
  # Access token expiration time in seconds
  # Default: 3600 (1 hour)
  # Common values:
  #   - 900 (15 minutes) - High security
  #   - 3600 (1 hour) - Standard
  #   - 86400 (24 hours) - Low security / development
  #
  # Shorter expiry = more secure but more frequent refreshes
  access_expiry: 3600
  
  # Refresh token expiration time in seconds
  # Default: 604800 (7 days)
  # Refresh tokens are single-use and invalidated after each refresh
  # Common values:
  #   - 86400 (1 day) - High security
  #   - 604800 (7 days) - Standard
  #   - 2592000 (30 days) - Long sessions
  refresh_expiry: 604800

# ============================================================================
# API Key Authentication Configuration (Optional)
# ============================================================================
# API Key Authentication (Optional)
# API keys use the unified Authorization: Bearer header format.
# Format: Authorization: Bearer moon_live_<64_chars>
# Use for integrations, CI/CD, service accounts.
# Default: disabled.
# Note: As of PRD-059, only Authorization: Bearer header is supported.
# The legacy X-API-Key header has been completely removed.
apikey:
  enabled: true

# ============================================================================
# Bootstrap Admin Configuration (First-Time Setup Only)
# ============================================================================
# Bootstrap Admin (First-Time Setup Only)
# Creates initial admin user if none exists. 
# Change password after login and remove this section.
# Never commit credentials to version control.
auth:
  bootstrap_admin:
    # Admin username (must be unique)
    username: "admin"
    
    # Admin email (must be unique, valid email format)
    email: "admin@example.com"
    
    # Initial password - CHANGE THIS IMMEDIATELY AFTER FIRST LOGIN!
    # Must meet password policy:
    # - Minimum 8 characters
    # - At least one uppercase letter
    # - At least one lowercase letter
    # - At least one number
    password: "moonadmin12#"
  
# ============================================================================
# Rate Limiting Configuration (Optional)
# ============================================================================
# Protects against abuse and ensures fair resource usage. Sliding window algorithm.
# Returns HTTP 429 Too Many Requests when exceeded, with Retry-After header.
# user_rpm: JWT users, requests per minute
# apikey_rpm: API key users, requests per minute
# login_attempts: Max failed logins per 15 min per IP/username
# login_window: Window in seconds (default: 900)
rate_limit:
  user_rpm: 100
  apikey_rpm: 1000
  login_attempts: 5
  # login_window: 900

# ============================================================================
# Recovery and Consistency Checking Configuration (Optional)
# ============================================================================
# recovery:
#   auto_repair: true      # Repair consistency issues on startup (default: true)
#   drop_orphans: false    # Drop orphaned tables (default: false, WARNING: data loss if true)
#   check_timeout: 5       # Consistency check timeout in seconds (default: 5)

# ============================================================================
# CORS Configuration (Optional)
# ============================================================================
# Cross-Origin Resource Sharing (CORS) for browser-based API access.
# When enabled, allows browsers to make cross-origin requests.
# Default: disabled for security.
# Example origins: "https://app.example.com", "http://localhost:3000" (development only)
# If you want to allow all origins (not recommended for production), you can use "*":
# 
# cors:
#   enabled: true
#   allowed_origins:
#     - "https://app.example.com"
#     - "http://localhost:3000"
#   allowed_methods: ["GET", "POST", "OPTIONS"]
#   allowed_headers: ["Content-Type", "Authorization"]
#   allow_credentials: true
#   max_age: 3600
#   
#   # Endpoint-specific CORS registration (PRD-058)
#   # Define CORS policies for specific routes or patterns.
#   # Pattern types: "exact", "prefix", "suffix", "contains"
#   # 
#   # Security:
#   # - bypass_auth: true only for public endpoints (health, docs, status)
#   # - Use specific origins in production (avoid "*" except for truly public data)
#   # 
#   # Default endpoints (if cors.endpoints not specified):
#   # - /health (exact, *, no auth)
#   # - /doc/ (prefix, *, no auth - matches /doc, /doc/, /doc/llms-full.txt, etc.)
#   #
#   endpoints:
#     # Health check (public, no authentication)
#     - path: "/health"
#       pattern_type: "exact"
#       allowed_origins: ["*"]
#       allowed_methods: ["GET", "OPTIONS"]
#       allowed_headers: ["Content-Type"]
#       allow_credentials: false
#       bypass_auth: true
#     
#     # Documentation (public, no authentication)
#     - path: "/doc/"
#       pattern_type: "prefix"
#       allowed_origins: ["*"]
#       allowed_methods: ["GET", "OPTIONS"]
#       allowed_headers: ["Content-Type"]
#       allow_credentials: false
#       bypass_auth: true
#     
#     # Example: Public API endpoints (requires authentication, selective CORS)
#     # - path: "/public/*"
#     #   pattern_type: "prefix"
#     #   allowed_origins: ["https://dashboard.example.com", "https://app.example.com"]
#     #   allowed_methods: ["GET", "OPTIONS"]
#     #   allowed_headers: ["Content-Type", "Authorization"]
#     #   allow_credentials: true
#     #   bypass_auth: false
#     
#     # Example: Webhooks (requires authentication, partner origins only)
#     # - path: "/webhooks/*"
#     #   pattern_type: "prefix"
#     #   allowed_origins: ["https://partner.example.com"]
#     #   allowed_methods: ["POST", "OPTIONS"]
#     #   allowed_headers: ["Content-Type", "Authorization", "X-Webhook-Signature"]
#     #   allow_credentials: false
#     #   bypass_auth: false

# ============================================================================
# Pagination Configuration (Optional)
# Controls default and maximum page sizes for list endpoints.
# Default: 15, Max: 200. Recommended: 10-50 for typical clients.
# ============================================================================
# pagination:
#   default_page_size: 15
#   max_page_size: 200

# ============================================================================
# System Limits Configuration (Optional)
# Controls maximum counts for collections, columns, and query parameters.
# Default: max_collections=1000, max_columns_per_collection=100, max_filters_per_request=20, max_sort_fields_per_request=5
# ============================================================================
# limits:
#   max_collections: 1000
#   max_columns_per_collection: 100
#   max_filters_per_request: 20
#   max_sort_fields_per_request: 5
